"use strict";var c=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var H=Object.prototype.hasOwnProperty;var s=(r,e)=>c(r,"name",{value:e,configurable:!0});var B=(r,e)=>{for(var t in e)c(r,t,{get:e[t],enumerable:!0})},k=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of C(e))!H.call(r,n)&&n!==t&&c(r,n,{get:()=>e[n],enumerable:!(o=T(e,n))||o.enumerable});return r};var L=r=>k(c({},"__esModule",{value:!0}),r);var F={};B(F,{HuaweiApiGatewayAdapter:()=>h});module.exports=L(F);var P=require("http");var E=require("http");function g(r){if(Buffer.isBuffer(r))return r.toString("utf8");if(typeof r=="string")return r;if(r instanceof Uint8Array)return new TextDecoder().decode(r);throw new Error(`response.write() of unexpected type: ${typeof r}`)}s(g,"getString");var w=`\r
\r
`,O=`0\r
\r
`,f=Symbol("Response body"),u=Symbol("Response headers");function y(r,e){if(Buffer.isBuffer(e)||typeof e=="string"||e instanceof Uint8Array)r[f].push(Buffer.from(e));else throw new Error(`response.write() of unexpected type: ${typeof e}`)}s(y,"addData");var m=class r extends E.ServerResponse{static{s(this,"ServerlessResponse")}constructor({method:e}){super({method:e}),this[f]=[],this[u]={},this.useChunkedEncodingByDefault=!1,this.chunkedEncoding=!1,this._header="";let t=1,o={_writableState:{},writable:!0,on:d,removeListener:d,destroy:d,cork:d,uncork:d,write:(n,i,a)=>{if(typeof i=="function"&&(a=i,i=null),this._header===""||this._wroteHeader)this.chunkedEncoding?t>0?t--:n!==O&&(y(this,n),t=3):y(this,n);else{let p=g(n),l=p.indexOf(w);if(l!==-1){let x=p.slice(l+w.length);x&&!this.chunkedEncoding&&y(this,x),this._wroteHeader=!0}}typeof a=="function"&&a()}};this.assignSocket(o)}_header;_headers;_wroteHeader;[f];[u];get headers(){return this[u]}static from(e){let t=new r({method:e.method});return t.statusCode=e.statusCode||0,t[u]=e.headers,t[f]=e.body?[Buffer.from(e.body)]:[],t.end(),t}static body(e){return Buffer.concat(e[f])}static headers(e){let t=e.getHeaders();return Object.assign(t,e[u])}setHeader(e,t){this._wroteHeader?this[u][e]=t:super.setHeader(e,t)}writeHead(e,t,o){let n=typeof t=="string"?o:t,i=Array.isArray(n)?n:[n||{}];for(let a of i)for(let p in a)if(this.setHeader(p,a[p]),!this._wroteHeader)break;return this.callNativeWriteHead(e,t,o)}callNativeWriteHead(e,t,o){return super.writeHead(e,t,o)}};var I=require("http");function v(r,e){let t=e?"base64":"utf8",o=Buffer.from(r,t),n=Buffer.byteLength(o,t);return[o,n]}s(v,"getEventBodyAsBuffer");function S(r,e=",",t=!1){return Object.keys(r).reduce((o,n)=>{let i=t?n.toLowerCase():n,a=r[n];return Array.isArray(a)?o[i]=a.join(e):o[i]=(a??"")+"",o},{})}s(S,"getFlattenedHeadersMap");function A(r){return Object.keys(r).reduce((e,t)=>{let o=r[t];return e[t.toLowerCase()]=Array.isArray(o)?o.map(String):[String(o)],e},{})}s(A,"getMultiValueHeadersMap");var d=s(()=>{},"NO_OP");var Ee=Symbol("InternalLogger");function R(r,e){return r===void 0?e:r}s(R,"getDefaultIfUndefined");function b(r,e){if(String(e||"").length===0)return r;if(typeof e=="string")return`${r}?${e}`;let t=_(e);return t?`${r}?${t}`:r}s(b,"getPathWithQueryStringParams");function _(r){let e=new URLSearchParams,t=Object.entries(r||{});if(t.length===0)return"";for(let[o,n]of t){if(!Array.isArray(n)){e.append(o,n||"");continue}for(let i of n)e.append(o,i)}return e.toString()}s(_,"getQueryParamsStringFromRecord");var Ce=require("stream");var h=class r{constructor(e){this.options=e}static{s(this,"HuaweiApiGatewayAdapter")}getAdapterName(){return r.name}canHandle(e){let t=e;return!!(t&&t.httpMethod&&t.requestContext&&t.requestContext.apiId&&t.requestContext.stage&&t.requestContext.requestId&&!("multiValueQueryStringParameters"in t))}getRequest(e){let t=e.httpMethod,o=this.getPathFromEvent(e),n=S(e.headers,",",!0),i;if(e.body){let[p,l]=v(e.body,e.isBase64Encoded);i=p,n["content-length"]=String(l)}let a=n["x-real-ip"];return{method:t,headers:n,body:i,remoteAddress:a,path:o}}getResponse({headers:e,body:t,isBase64Encoded:o,statusCode:n}){let i=A(e);return{statusCode:n,body:t,headers:i,isBase64Encoded:o}}onErrorWhileForwarding({error:e,delegatedResolver:t,respondWithErrors:o,event:n,log:i}){let a=o?e.stack:"",p=this.getResponse({event:n,statusCode:500,body:a||"",headers:{},isBase64Encoded:!1,log:i});t.succeed(p)}getPathFromEvent(e){let t=R(this.options?.stripBasePath,""),o=new RegExp(`^${t}`),n=e.path.replace(o,""),i=e.queryStringParameters;return b(n,i)}};0&&(module.exports={HuaweiApiGatewayAdapter});
//# sourceMappingURL=index.cjs.map