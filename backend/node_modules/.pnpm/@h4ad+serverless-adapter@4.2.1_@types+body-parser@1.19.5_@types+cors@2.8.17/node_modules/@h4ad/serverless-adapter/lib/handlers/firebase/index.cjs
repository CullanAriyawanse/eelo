"use strict";var m=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var L=Object.prototype.hasOwnProperty;var s=(t,e)=>m(t,"name",{value:e,configurable:!0});var I=(t,e)=>{for(var r in e)m(t,r,{get:e[r],enumerable:!0})},O=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of B(e))!L.call(t,o)&&o!==r&&m(t,o,{get:()=>e[o],enumerable:!(n=H(e,o))||n.enumerable});return t};var P=t=>O(m({},"__esModule",{value:!0}),t);var V={};I(V,{HttpFirebaseHandler:()=>x,HttpFirebaseV2Handler:()=>S});module.exports=P(V);var k=require("firebase-functions/v1");var w=require("http");function T(t,e){let r=e?"base64":"utf8",n=Buffer.from(t,r),o=Buffer.byteLength(n,r);return[n,o]}s(T,"getEventBodyAsBuffer");function A(t,e=",",r=!1){return Object.keys(t).reduce((n,o)=>{let i=r?o.toLowerCase():o,a=t[o];return Array.isArray(a)?n[i]=a.join(e):n[i]=(a??"")+"",n},{})}s(A,"getFlattenedHeadersMap");var p=s(()=>{},"NO_OP");var re=Symbol("InternalLogger");var pe=require("stream");var F=443,l=class extends w.IncomingMessage{static{s(this,"ServerlessRequest")}constructor({method:e,url:r,headers:n,body:o,remoteAddress:i}){super({encrypted:!0,readable:!1,remoteAddress:i,address:()=>({port:F}),end:p,destroy:p}),this.statusCode=200,this.statusMessage="OK",this.complete=!0,this.httpVersion="1.1",this.httpVersionMajor=1,this.httpVersionMinor=1,this.method=e,this.headers=n,this.body=o,this.url=r,this.ip=i,this._read=()=>{this.push(o),this.push(null)}}ip;body};var C=require("http");function h(t){if(Buffer.isBuffer(t))return t.toString("utf8");if(typeof t=="string")return t;if(t instanceof Uint8Array)return new TextDecoder().decode(t);throw new Error(`response.write() of unexpected type: ${typeof t}`)}s(h,"getString");var E=`\r
\r
`,_=`0\r
\r
`,c=Symbol("Response body"),u=Symbol("Response headers");function v(t,e){if(Buffer.isBuffer(e)||typeof e=="string"||e instanceof Uint8Array)t[c].push(Buffer.from(e));else throw new Error(`response.write() of unexpected type: ${typeof e}`)}s(v,"addData");var y=class t extends C.ServerResponse{static{s(this,"ServerlessResponse")}constructor({method:e}){super({method:e}),this[c]=[],this[u]={},this.useChunkedEncodingByDefault=!1,this.chunkedEncoding=!1,this._header="";let r=1,n={_writableState:{},writable:!0,on:p,removeListener:p,destroy:p,cork:p,uncork:p,write:(o,i,a)=>{if(typeof i=="function"&&(a=i,i=null),this._header===""||this._wroteHeader)this.chunkedEncoding?r>0?r--:o!==_&&(v(this,o),r=3):v(this,o);else{let d=h(o),g=d.indexOf(E);if(g!==-1){let b=d.slice(g+E.length);b&&!this.chunkedEncoding&&v(this,b),this._wroteHeader=!0}}typeof a=="function"&&a()}};this.assignSocket(n)}_header;_headers;_wroteHeader;[c];[u];get headers(){return this[u]}static from(e){let r=new t({method:e.method});return r.statusCode=e.statusCode||0,r[u]=e.headers,r[c]=e.body?[Buffer.from(e.body)]:[],r.end(),r}static body(e){return Buffer.concat(e[c])}static headers(e){let r=e.getHeaders();return Object.assign(r,e[u])}setHeader(e,r){this._wroteHeader?this[u][e]=r:super.setHeader(e,r)}writeHead(e,r,n){let o=typeof r=="string"?n:r,i=Array.isArray(o)?o:[o||{}];for(let a of i)for(let d in a)if(this.setHeader(d,a[d]),!this._wroteHeader)break;return this.callNativeWriteHead(e,r,n)}callNativeWriteHead(e,r,n){return super.writeHead(e,r,n)}};var q=require("http");var f=class{static{s(this,"RawRequest")}onRequestCallback(e,r){return(n,o)=>{let i=this.getRequestFromExpressRequest(n);return r.sendRequest(e,i,o)}}getRequestFromExpressRequest(e){let r=e,n=A(e.headers,",",!0),o=n["x-forwarded-for"],i;if(r.body&&typeof r.body=="object"){let a=JSON.stringify(r.body),[d,g]=T(a,!1);i=d,n["content-length"]=String(g)}return new l({method:e.method,url:e.url,body:i,headers:n,remoteAddress:o})}};var x=class extends f{static{s(this,"HttpFirebaseHandler")}getHandler(e,r){return k.https.onRequest(this.onRequestCallback(e,r))}};var er=require("http"),R=require("firebase-functions/v2");var S=class extends f{constructor(r){super();this.options=r}static{s(this,"HttpFirebaseV2Handler")}getHandler(r,n){return this.options?this.onRequestWithOptions(this.options,this.onRequestCallback(r,n)):R.https.onRequest(this.onRequestCallback(r,n))}onRequestWithOptions(r,n){return R.https.onRequest(r,n)}};0&&(module.exports={HttpFirebaseHandler,HttpFirebaseV2Handler});
//# sourceMappingURL=index.cjs.map