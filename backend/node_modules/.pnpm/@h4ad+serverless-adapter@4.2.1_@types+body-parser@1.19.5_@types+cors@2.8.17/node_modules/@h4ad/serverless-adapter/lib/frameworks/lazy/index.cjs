"use strict";var l=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var n=(t,e)=>l(t,"name",{value:e,configurable:!0});var b=(t,e)=>{for(var r in e)l(t,r,{get:e[r],enumerable:!0})},w=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of E(e))!T.call(t,o)&&o!==r&&l(t,o,{get:()=>e[o],enumerable:!(s=A(e,o))||s.enumerable});return t};var C=t=>w(l({},"__esModule",{value:!0}),t);var _={};b(_,{LazyFramework:()=>m});module.exports=C(_);var k=require("http");var R=require("http");function f(t){if(Buffer.isBuffer(t))return t.toString("utf8");if(typeof t=="string")return t;if(t instanceof Uint8Array)return new TextDecoder().decode(t);throw new Error(`response.write() of unexpected type: ${typeof t}`)}n(f,"getString");var x=`\r
\r
`,L=`0\r
\r
`,c=Symbol("Response body"),d=Symbol("Response headers");function g(t,e){if(Buffer.isBuffer(e)||typeof e=="string"||e instanceof Uint8Array)t[c].push(Buffer.from(e));else throw new Error(`response.write() of unexpected type: ${typeof e}`)}n(g,"addData");var y=class t extends R.ServerResponse{static{n(this,"ServerlessResponse")}constructor({method:e}){super({method:e}),this[c]=[],this[d]={},this.useChunkedEncodingByDefault=!1,this.chunkedEncoding=!1,this._header="";let r=1,s={_writableState:{},writable:!0,on:i,removeListener:i,destroy:i,cork:i,uncork:i,write:(o,p,a)=>{if(typeof p=="function"&&(a=p,p=null),this._header===""||this._wroteHeader)this.chunkedEncoding?r>0?r--:o!==L&&(g(this,o),r=3):g(this,o);else{let u=f(o),h=u.indexOf(x);if(h!==-1){let S=u.slice(h+x.length);S&&!this.chunkedEncoding&&g(this,S),this._wroteHeader=!0}}typeof a=="function"&&a()}};this.assignSocket(s)}_header;_headers;_wroteHeader;[c];[d];get headers(){return this[d]}static from(e){let r=new t({method:e.method});return r.statusCode=e.statusCode||0,r[d]=e.headers,r[c]=e.body?[Buffer.from(e.body)]:[],r.end(),r}static body(e){return Buffer.concat(e[c])}static headers(e){let r=e.getHeaders();return Object.assign(r,e[d])}setHeader(e,r){this._wroteHeader?this[d][e]=r:super.setHeader(e,r)}writeHead(e,r,s){let o=typeof r=="string"?s:r,p=Array.isArray(o)?o:[o||{}];for(let a of p)for(let u in a)if(this.setHeader(u,a[u]),!this._wroteHeader)break;return this.callNativeWriteHead(e,r,s)}callNativeWriteHead(e,r,s){return super.writeHead(e,r,s)}};var B=require("http");var i=n(()=>{},"NO_OP");var H=Symbol("InternalLogger"),I={debug:[["debug","debug"],["verbose","debug"],["info","info"],["error","error"],["warn","warn"]],verbose:[["verbose","debug"],["info","info"],["error","error"],["warn","warn"]],info:[["info","info"],["error","error"],["warn","warn"]],warn:[["warn","warn"],["error","error"]],error:[["error","error"]],none:[]},O=n(t=>typeof t=="function"?t():t,"lazyPrint"),P=n(t=>(e,...r)=>console[t](e,...r.map(O)),"print");function v({level:t}={level:"error"}){let e=I[t];if(!e)throw new Error("Invalid log level");let r={[H]:!0,error:i,debug:i,info:i,verbose:i,warn:i};for(let[s,o]of e)r[s]=P(o);return r}n(v,"createDefaultLogger");var be=require("stream");var m=class{constructor(e,r,s=v()){this.framework=e;this.factory=r;this.logger=s;this.delayedFactory=Promise.resolve().then(()=>r()).then(o=>{this.cachedApp=o}).catch(o=>{this.logger.error("SERVERLESS_ADAPTER:LAZY_FRAMEWORK: An error occours during the creation of your app."),this.logger.error(o)})}static{n(this,"LazyFramework")}cachedApp;delayedFactory;sendRequest(e,r,s){if(this.cachedApp)return this.framework.sendRequest(this.cachedApp,r,s);this.delayedFactory.then(()=>this.cachedApp?this.framework.sendRequest(this.cachedApp,r,s):s.emit("error",new Error("SERVERLESS_ADAPTER:LAZY_FRAMEWORK: The instance of the app returned by the factory is not valid, see the logs to learn more.")))}};0&&(module.exports={LazyFramework});
//# sourceMappingURL=index.cjs.map