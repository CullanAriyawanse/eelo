"use strict";var l=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var s=(r,e)=>l(r,"name",{value:e,configurable:!0});var H=(r,e)=>{for(var t in e)l(r,t,{get:e[t],enumerable:!0})},k=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of w(e))!E.call(r,n)&&n!==t&&l(r,n,{get:()=>e[n],enumerable:!(o=b(e,n))||o.enumerable});return r};var B=r=>k(l({},"__esModule",{value:!0}),r);var P={};H(P,{BufferToJSObjectTransformer:()=>h,TrpcFramework:()=>x});module.exports=B(P);var A=require("@trpc/server/adapters/node-http");var L=require("http");var S=require("http");function c(r){if(Buffer.isBuffer(r))return r.toString("utf8");if(typeof r=="string")return r;if(r instanceof Uint8Array)return new TextDecoder().decode(r);throw new Error(`response.write() of unexpected type: ${typeof r}`)}s(c,"getString");var v=`\r
\r
`,O=`0\r
\r
`,f=Symbol("Response body"),p=Symbol("Response headers");function g(r,e){if(Buffer.isBuffer(e)||typeof e=="string"||e instanceof Uint8Array)r[f].push(Buffer.from(e));else throw new Error(`response.write() of unexpected type: ${typeof e}`)}s(g,"addData");var m=class r extends S.ServerResponse{static{s(this,"ServerlessResponse")}constructor({method:e}){super({method:e}),this[f]=[],this[p]={},this.useChunkedEncodingByDefault=!1,this.chunkedEncoding=!1,this._header="";let t=1,o={_writableState:{},writable:!0,on:d,removeListener:d,destroy:d,cork:d,uncork:d,write:(n,i,a)=>{if(typeof i=="function"&&(a=i,i=null),this._header===""||this._wroteHeader)this.chunkedEncoding?t>0?t--:n!==O&&(g(this,n),t=3):g(this,n);else{let u=c(n),T=u.indexOf(v);if(T!==-1){let C=u.slice(T+v.length);C&&!this.chunkedEncoding&&g(this,C),this._wroteHeader=!0}}typeof a=="function"&&a()}};this.assignSocket(o)}_header;_headers;_wroteHeader;[f];[p];get headers(){return this[p]}static from(e){let t=new r({method:e.method});return t.statusCode=e.statusCode||0,t[p]=e.headers,t[f]=e.body?[Buffer.from(e.body)]:[],t.end(),t}static body(e){return Buffer.concat(e[f])}static headers(e){let t=e.getHeaders();return Object.assign(t,e[p])}setHeader(e,t){this._wroteHeader?this[p][e]=t:super.setHeader(e,t)}writeHead(e,t,o){let n=typeof t=="string"?o:t,i=Array.isArray(n)?n:[n||{}];for(let a of i)for(let u in a)if(this.setHeader(u,a[u]),!this._wroteHeader)break;return this.callNativeWriteHead(e,t,o)}callNativeWriteHead(e,t,o){return super.writeHead(e,t,o)}};var I=require("http");function y(r,e=",",t=!1){return Object.keys(r).reduce((o,n)=>{let i=t?n.toLowerCase():n,a=r[n];return Array.isArray(a)?o[i]=a.join(e):o[i]=(a??"")+"",o},{})}s(y,"getFlattenedHeadersMap");var d=s(()=>{},"NO_OP");var xe=Symbol("InternalLogger");function R(r,e){return r===void 0?e:r}s(R,"getDefaultIfUndefined");var be=require("stream");var h=class{static{s(this,"BufferToJSObjectTransformer")}deserialize(e){return e instanceof Buffer?JSON.parse(e.toString("utf-8")):e}serialize(e){return e}},x=class{constructor(e){this.options=e}static{s(this,"TrpcFramework")}sendRequest(e,t,o){let n=this.getSafeUrlForTrpc(t);(0,A.nodeHTTPRequestHandler)({req:t,res:o,path:n,router:e,...this.options,createContext:i=>this.mergeDefaultContextWithOptionsContext(i)})}getSafeUrlForTrpc(e){let t=e.url;return t.startsWith("/")&&(t=t.slice(1)),t.includes("?")&&(t=t.split("?")[0]),t}mergeDefaultContextWithOptionsContext(e){let o=R(this.options?.createContext,()=>{})(e);return o&&o.then?o.then(n=>this.wrapResolvedContextWithDefaultContext(n,e)):this.wrapResolvedContextWithDefaultContext(o,e)}wrapResolvedContextWithDefaultContext(e,t){let o=t.req,n=t.res;return{...e,request:o,response:n,getUrl:()=>o.url,getMethod:()=>o.method,getHeaders:()=>y(o.headers,",",!0),setHeader:(i,a)=>{n.setHeader(i,a)},removeHeader:i=>{n.removeHeader(i)},getHeader:i=>y(o.headers,",",!0)[i.toLowerCase()],setStatus:i=>{n.statusCode=i,n.statusMessage=void 0},getIp:()=>o.connection.remoteAddress}}};0&&(module.exports={BufferToJSObjectTransformer,TrpcFramework});
//# sourceMappingURL=index.cjs.map