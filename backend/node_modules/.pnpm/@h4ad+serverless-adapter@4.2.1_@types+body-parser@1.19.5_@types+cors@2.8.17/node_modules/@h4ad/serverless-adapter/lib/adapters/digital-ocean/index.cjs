"use strict";var f=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var H=Object.prototype.hasOwnProperty;var s=(r,e)=>f(r,"name",{value:e,configurable:!0});var C=(r,e)=>{for(var t in e)f(r,t,{get:e[t],enumerable:!0})},_=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of T(e))!H.call(r,n)&&n!==t&&f(r,n,{get:()=>e[n],enumerable:!(o=A(e,n))||o.enumerable});return r};var B=r=>_(f({},"__esModule",{value:!0}),r);var I={};C(I,{HttpFunctionAdapter:()=>h});module.exports=B(I);var k=require("http");var v=require("http");function g(r){if(Buffer.isBuffer(r))return r.toString("utf8");if(typeof r=="string")return r;if(r instanceof Uint8Array)return new TextDecoder().decode(r);throw new Error(`response.write() of unexpected type: ${typeof r}`)}s(g,"getString");var E=`\r
\r
`,O=`0\r
\r
`,c=Symbol("Response body"),u=Symbol("Response headers");function y(r,e){if(Buffer.isBuffer(e)||typeof e=="string"||e instanceof Uint8Array)r[c].push(Buffer.from(e));else throw new Error(`response.write() of unexpected type: ${typeof e}`)}s(y,"addData");var m=class r extends v.ServerResponse{static{s(this,"ServerlessResponse")}constructor({method:e}){super({method:e}),this[c]=[],this[u]={},this.useChunkedEncodingByDefault=!1,this.chunkedEncoding=!1,this._header="";let t=1,o={_writableState:{},writable:!0,on:p,removeListener:p,destroy:p,cork:p,uncork:p,write:(n,i,a)=>{if(typeof i=="function"&&(a=i,i=null),this._header===""||this._wroteHeader)this.chunkedEncoding?t>0?t--:n!==O&&(y(this,n),t=3):y(this,n);else{let d=g(n),l=d.indexOf(E);if(l!==-1){let x=d.slice(l+E.length);x&&!this.chunkedEncoding&&y(this,x),this._wroteHeader=!0}}typeof a=="function"&&a()}};this.assignSocket(o)}_header;_headers;_wroteHeader;[c];[u];get headers(){return this[u]}static from(e){let t=new r({method:e.method});return t.statusCode=e.statusCode||0,t[u]=e.headers,t[c]=e.body?[Buffer.from(e.body)]:[],t.end(),t}static body(e){return Buffer.concat(e[c])}static headers(e){let t=e.getHeaders();return Object.assign(t,e[u])}setHeader(e,t){this._wroteHeader?this[u][e]=t:super.setHeader(e,t)}writeHead(e,t,o){let n=typeof t=="string"?o:t,i=Array.isArray(n)?n:[n||{}];for(let a of i)for(let d in a)if(this.setHeader(d,a[d]),!this._wroteHeader)break;return this.callNativeWriteHead(e,t,o)}callNativeWriteHead(e,t,o){return super.writeHead(e,t,o)}};var L=require("http");function R(r,e){let t=e?"base64":"utf8",o=Buffer.from(r,t),n=Buffer.byteLength(o,t);return[o,n]}s(R,"getEventBodyAsBuffer");function S(r,e=",",t=!1){return Object.keys(r).reduce((o,n)=>{let i=t?n.toLowerCase():n,a=r[n];return Array.isArray(a)?o[i]=a.join(e):o[i]=(a??"")+"",o},{})}s(S,"getFlattenedHeadersMap");var p=s(()=>{},"NO_OP");var Ee=Symbol("InternalLogger");function b(r,e){return r===void 0?e:r}s(b,"getDefaultIfUndefined");function w(r,e){if(String(e||"").length===0)return r;if(typeof e=="string")return`${r}?${e}`;let t=P(e);return t?`${r}?${t}`:r}s(w,"getPathWithQueryStringParams");function P(r){let e=new URLSearchParams,t=Object.entries(r||{});if(t.length===0)return"";for(let[o,n]of t){if(!Array.isArray(n)){e.append(o,n||"");continue}for(let i of n)e.append(o,i)}return e.toString()}s(P,"getQueryParamsStringFromRecord");var Te=require("stream");var h=class r{constructor(e){this.options=e}static{s(this,"HttpFunctionAdapter")}getAdapterName(){return r.name}canHandle(e){let t=e;return!!t&&t.__ow_path!==void 0&&t.__ow_method!==void 0&&t.__ow_headers!==void 0}getRequest(e){let t=e.__ow_headers,o=e.__ow_method.toUpperCase(),n=this.getPathFromEvent(e),i;if(e.__ow_body){let[d,l]=R(e.__ow_body,!!e.__ow_isBase64Encoded);i=d,t["content-length"]=String(l)}let a=t["x-forwarded-for"];return{method:o,headers:t,body:i,remoteAddress:a,path:n}}getResponse({headers:e,body:t,statusCode:o}){let n=S(e);return{statusCode:o,body:t,headers:n}}onErrorWhileForwarding({error:e,delegatedResolver:t,respondWithErrors:o,event:n,log:i}){let a=o?e.stack:"",d=this.getResponse({event:n,statusCode:500,body:a||"",headers:{},isBase64Encoded:!1,log:i});t.succeed(d)}getPathFromEvent(e){let t=b(this.options?.stripBasePath,""),o=new RegExp(`^${t}`),n=e.__ow_path.replace(o,""),i=e.__ow_query;return w(n,i||{})}};0&&(module.exports={HttpFunctionAdapter});
//# sourceMappingURL=index.cjs.map