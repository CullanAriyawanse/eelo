import{a as s}from"./chunk-OYOJMOFP.mjs";import{IncomingMessage as j}from"node:http";var Q=["gzip","deflate","br"],G=["image/png","image/jpeg","image/jpg","image/avif","image/bmp","image/x-png","image/gif","image/webp","video/mp4","application/pdf"],J={};var S={context:null,event:null};function Z(){return S}s(Z,"getCurrentInvoke");function K({event:r,context:e}){S.event=r,S.context=e}s(K,"setCurrentInvoke");function te(r,e){let t=e?"base64":"utf8",n=Buffer.from(r,t),o=Buffer.byteLength(n,t);return[n,o]}s(te,"getEventBodyAsBuffer");function se(r,e=",",t=!1){return Object.keys(r).reduce((n,o)=>{let i=t?o.toLowerCase():o,a=r[o];return Array.isArray(a)?n[i]=a.join(e):n[i]=(a??"")+"",n},{})}s(se,"getFlattenedHeadersMap");function ie(r){return Object.keys(r).reduce((e,t)=>{let n=r[t];return e[t.toLowerCase()]=Array.isArray(n)?n.map(String):[String(n)],e},{})}s(ie,"getMultiValueHeadersMap");function ae(r){return Object.keys(r).reduce((e,t)=>{let n=r[t],o=t.toLowerCase();return Array.isArray(n)?o!=="set-cookie"?e.headers[t]=n.join(","):e.cookies.push(...n):o==="set-cookie"&&n!==void 0?e.cookies.push(n??""):e.headers[t]=String(n??""),e},{cookies:[],headers:{}})}s(ae,"getFlattenedHeadersMapAndCookies");function b(r){if(!r)return{};let e={},t=r.trim().split(`
`);for(let n=0;n<t.length;n++){let o=t[n],i=o.indexOf(":"),a=o.slice(0,i).trim().toLowerCase(),u=o.slice(i+1).trim();typeof e[a]>"u"?e[a]=u:Array.isArray(e[a])?e[a].push(u):e[a]=[e[a],u]}return e}s(b,"parseHeaders");function I(r,e){let t=r["content-encoding"];return t?(Array.isArray(t)||(t=t.split(",")),t.some(n=>e.includes(n.trim()))):!1}s(I,"isContentEncodingBinary");function O(r){let e=r["content-type"],t=Array.isArray(e)?e[0]||"":e||"";if(!e)return"";let n=t.indexOf(";");return n===-1?t:t.slice(0,n)}s(O,"getContentType");function P(r,e){let t=O(r);return t?e.includes(t.trim()):!1}s(P,"isContentTypeBinary");function fe(r,e){return"isBinary"in e?e.isBinary===!1?!1:e.isBinary(r):I(r,e.contentEncodings)||P(r,e.contentTypes)}s(fe,"isBinary");var d=s(()=>{},"NO_OP");var w=Symbol("InternalLogger"),_={debug:[["debug","debug"],["verbose","debug"],["info","info"],["error","error"],["warn","warn"]],verbose:[["verbose","debug"],["info","info"],["error","error"],["warn","warn"]],info:[["info","info"],["error","error"],["warn","warn"]],warn:[["warn","warn"],["error","error"]],error:[["error","error"]],none:[]},V=s(r=>typeof r=="function"?r():r,"lazyPrint"),F=s(r=>(e,...t)=>console[r](e,...t.map(V)),"print");function me({level:r}={level:"error"}){let e=_[r];if(!e)throw new Error("Invalid log level");let t={[w]:!0,error:d,debug:d,info:d,verbose:d,warn:d};for(let[n,o]of e)t[n]=F(o);return t}s(me,"createDefaultLogger");function he(r){return!!r[w]}s(he,"isInternalLogger");function ve(r,e){return r===void 0?e:r}s(ve,"getDefaultIfUndefined");function Re(r,e){if(String(e||"").length===0)return r;if(typeof e=="string")return`${r}?${e}`;let t=D(e);return t?`${r}?${t}`:r}s(Re,"getPathWithQueryStringParams");function D(r){let e=new URLSearchParams,t=Object.entries(r||{});if(t.length===0)return"";for(let[n,o]of t){if(!Array.isArray(o)){e.append(n,o||"");continue}for(let i of o)e.append(n,i)}return e.toString()}s(D,"getQueryParamsStringFromRecord");var N=s(r=>r,"NOOPBasePath");function be(r){if(!r)return N;let e=r.length;return t=>t.startsWith(r)?t.slice(t.indexOf(r)+e,t.length)||"/":t}s(be,"buildStripBasePath");import"node:stream";function W(r){return!!("readableEnded"in r&&r.readableEnded||"writableEnded"in r&&r.writableEnded)}s(W,"isStreamEnded");function He(r){return W(r)?Promise.resolve(r):new Promise((e,t)=>{let n=!1;function o(i){n||(n=!0,r.removeListener("error",o),r.removeListener("end",o),r.removeListener("finish",o),i?t(i):e(r))}s(o,"complete"),r.once("error",o),r.once("end",o),r.once("finish",o)})}s(He,"waitForStreamComplete");var U=443,y=class extends j{static{s(this,"ServerlessRequest")}constructor({method:e,url:t,headers:n,body:o,remoteAddress:i}){super({encrypted:!0,readable:!1,remoteAddress:i,address:()=>({port:U}),end:d,destroy:d}),this.statusCode=200,this.statusMessage="OK",this.complete=!0,this.httpVersion="1.1",this.httpVersionMajor=1,this.httpVersionMinor=1,this.method=e,this.headers=n,this.body=o,this.url=t,this.ip=i,this._read=()=>{this.push(o),this.push(null)}}ip;body};import{ServerResponse as M}from"node:http";function m(r){if(Buffer.isBuffer(r))return r.toString("utf8");if(typeof r=="string")return r;if(r instanceof Uint8Array)return new TextDecoder().decode(r);throw new Error(`response.write() of unexpected type: ${typeof r}`)}s(m,"getString");var A=`\r
\r
`,$=`0\r
\r
`,g=Symbol("Response body"),l=Symbol("Response headers");function v(r,e){if(Buffer.isBuffer(e)||typeof e=="string"||e instanceof Uint8Array)r[g].push(Buffer.from(e));else throw new Error(`response.write() of unexpected type: ${typeof e}`)}s(v,"addData");var h=class r extends M{static{s(this,"ServerlessResponse")}constructor({method:e}){super({method:e}),this[g]=[],this[l]={},this.useChunkedEncodingByDefault=!1,this.chunkedEncoding=!1,this._header="";let t=1,n={_writableState:{},writable:!0,on:d,removeListener:d,destroy:d,cork:d,uncork:d,write:(o,i,a)=>{if(typeof i=="function"&&(a=i,i=null),this._header===""||this._wroteHeader)this.chunkedEncoding?t>0?t--:o!==$&&(v(this,o),t=3):v(this,o);else{let u=m(o),f=u.indexOf(A);if(f!==-1){let p=u.slice(f+A.length);p&&!this.chunkedEncoding&&v(this,p),this._wroteHeader=!0}}typeof a=="function"&&a()}};this.assignSocket(n)}_header;_headers;_wroteHeader;[g];[l];get headers(){return this[l]}static from(e){let t=new r({method:e.method});return t.statusCode=e.statusCode||0,t[l]=e.headers,t[g]=e.body?[Buffer.from(e.body)]:[],t.end(),t}static body(e){return Buffer.concat(e[g])}static headers(e){let t=e.getHeaders();return Object.assign(t,e[l])}setHeader(e,t){this._wroteHeader?this[l][e]=t:super.setHeader(e,t)}writeHead(e,t,n){let o=typeof t=="string"?n:t,i=Array.isArray(o)?o:[o||{}];for(let a of i)for(let u in a)if(this.setHeader(u,a[u]),!this._wroteHeader)break;return this.callNativeWriteHead(e,t,n)}callNativeWriteHead(e,t,n){return super.writeHead(e,t,n)}};import{ServerResponse as Y}from"node:http";var C=`0\r
\r
`,q=`\r
\r
`,z=`\r
`,k=class extends Y{static{s(this,"ServerlessStreamResponse")}constructor({method:e,onReceiveHeaders:t,log:n}){super({method:e}),this.useChunkedEncodingByDefault=!0,this.chunkedEncoding=!0;let o=null,i=!0,a=0,u={_writableState:{},writable:!0,on:d,removeListener:d,destroy:d,cork:d,uncork:d,write:(f,p,x)=>{if(typeof p=="function"&&(x=p,p=null),n.debug("SERVERLESS_ADAPTER:RESPONSE_STREAM:DATA",()=>({data:Buffer.isBuffer(f)?f.toString("utf8"):f,encoding:p})),!i&&o){if(f===C)return o.end(x),!0;if(a>0)return a--,!0;o.write(f,x),a=3}else if(i){i=!1;let c=m(f),T=c.indexOf(z),H=+c.slice(0,T).split(" ")[1],E=c.indexOf(q),L=c.slice(T+2,E),R=b(L);n.debug("SERVERLESS_ADAPTER:RESPONSE_STREAM:FRAMEWORK_HEADERS",()=>({headers:R})),a=1,o=t(H,R),c.substring(E+4)===C&&o.end()}return!0}};this.assignSocket(u)}};var B=class{static{s(this,"BaseHandler")}getAdapterByEventAndContext(e,t,n,o){let i=n.filter(a=>a.canHandle(e,t,o));if(i.length===0)throw new Error("SERVERLESS_ADAPTER: Couldn't find adapter to handle this event.");if(i.length>1)throw new Error(`SERVERLESS_ADAPTER: Two or more adapters was resolved by the event, the adapters are: ${n.map(a=>a.getAdapterName()).join(", ")}.`);return i[0]}getServerlessRequestResponseFromAdapterRequest(e){let t=new y({method:e.method,headers:e.headers,body:e.body,remoteAddress:e.remoteAddress,url:e.path}),n=new h({method:e.method});return[t,n]}};export{B as a,Q as b,G as c,J as d,Z as e,K as f,te as g,se as h,ie as i,ae as j,b as k,I as l,O as m,P as n,fe as o,d as p,me as q,he as r,ve as s,Re as t,D as u,be as v,W as w,He as x,y,m as z,h as A,k as B};
//# sourceMappingURL=chunk-MQYXRLYI.mjs.map