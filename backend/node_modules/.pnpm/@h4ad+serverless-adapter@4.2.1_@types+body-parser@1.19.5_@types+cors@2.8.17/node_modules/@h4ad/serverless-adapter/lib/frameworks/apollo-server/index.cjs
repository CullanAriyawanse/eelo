"use strict";var g=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var n=(t,e)=>g(t,"name",{value:e,configurable:!0});var w=(t,e)=>{for(var r in e)g(t,r,{get:e[r],enumerable:!0})},k=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of C(e))!E.call(t,s)&&s!==r&&g(t,s,{get:()=>e[s],enumerable:!(o=b(e,s))||o.enumerable});return t};var B=t=>k(g({},"__esModule",{value:!0}),t);var O={};w(O,{ApolloServerFramework:()=>x});module.exports=B(O);var R=require("@apollo/server");var H=require("http");var d=n(()=>{},"NO_OP");var Z=Symbol("InternalLogger");function S(t,e){return t===void 0?e:t}n(S,"getDefaultIfUndefined");var oe=require("stream");var T=require("http");function m(t){if(Buffer.isBuffer(t))return t.toString("utf8");if(typeof t=="string")return t;if(t instanceof Uint8Array)return new TextDecoder().decode(t);throw new Error(`response.write() of unexpected type: ${typeof t}`)}n(m,"getString");var v=`\r
\r
`,L=`0\r
\r
`,c=Symbol("Response body"),u=Symbol("Response headers");function h(t,e){if(Buffer.isBuffer(e)||typeof e=="string"||e instanceof Uint8Array)t[c].push(Buffer.from(e));else throw new Error(`response.write() of unexpected type: ${typeof e}`)}n(h,"addData");var y=class t extends T.ServerResponse{static{n(this,"ServerlessResponse")}constructor({method:e}){super({method:e}),this[c]=[],this[u]={},this.useChunkedEncodingByDefault=!1,this.chunkedEncoding=!1,this._header="";let r=1,o={_writableState:{},writable:!0,on:d,removeListener:d,destroy:d,cork:d,uncork:d,write:(s,f,l)=>{if(typeof f=="function"&&(l=f,f=null),this._header===""||this._wroteHeader)this.chunkedEncoding?r>0?r--:s!==L&&(h(this,s),r=3):h(this,s);else{let p=m(s),i=p.indexOf(v);if(i!==-1){let a=p.slice(i+v.length);a&&!this.chunkedEncoding&&h(this,a),this._wroteHeader=!0}}typeof l=="function"&&l()}};this.assignSocket(o)}_header;_headers;_wroteHeader;[c];[u];get headers(){return this[u]}static from(e){let r=new t({method:e.method});return r.statusCode=e.statusCode||0,r[u]=e.headers,r[c]=e.body?[Buffer.from(e.body)]:[],r.end(),r}static body(e){return Buffer.concat(e[c])}static headers(e){let r=e.getHeaders();return Object.assign(r,e[u])}setHeader(e,r){this._wroteHeader?this[u][e]=r:super.setHeader(e,r)}writeHead(e,r,o){let s=typeof r=="string"?o:r,f=Array.isArray(s)?s:[s||{}];for(let l of f)for(let p in l)if(this.setHeader(p,l[p]),!this._wroteHeader)break;return this.callNativeWriteHead(e,r,o)}callNativeWriteHead(e,r,o){return super.writeHead(e,r,o)}};var I=require("http");var x=class{constructor(e){this.options=e}static{n(this,"ApolloServerFramework")}sendRequest(e,r,o){let s=new R.HeaderMap;for(let[i,a]of Object.entries(r.headers))a!==void 0&&s.set(i,Array.isArray(a)?a.join(", "):a.toString());let f=n(i=>Promise.resolve(i),"defaultContext"),l=n(()=>S(this.options?.context,f)({request:r,response:o}),"context"),p=r.url?.startsWith("http")?new URL(r.url).search??"":r.url?.split("?")[1]||"";e.executeHTTPGraphQLRequest({httpGraphQLRequest:{method:r.method.toUpperCase(),headers:s,body:r.body,search:p},context:l}).then(async i=>{for(let[a,A]of i.headers)o.setHeader(a,A);if(o.statusCode=i.status||200,i.body.kind==="complete"){o.end(i.body.string);return}for await(let a of i.body.asyncIterator)o.write(a),typeof o.flush=="function"&&o.flush();o.end()})}};0&&(module.exports={ApolloServerFramework});
//# sourceMappingURL=index.cjs.map