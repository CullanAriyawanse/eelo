"use strict";var g=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var B=Object.prototype.hasOwnProperty;var s=(n,e)=>g(n,"name",{value:e,configurable:!0});var H=(n,e)=>{for(var r in e)g(n,r,{get:e[r],enumerable:!0})},L=(n,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of k(e))!B.call(n,t)&&t!==r&&g(n,t,{get:()=>e[t],enumerable:!(o=C(e,t))||o.enumerable});return n};var I=n=>L(g({},"__esModule",{value:!0}),n);var F={};H(F,{GCPHandler:()=>x});module.exports=I(F);var w=require("@google-cloud/functions-framework");var T=require("http");function R(n,e){let r=e?"base64":"utf8",o=Buffer.from(n,r),t=Buffer.byteLength(o,r);return[o,t]}s(R,"getEventBodyAsBuffer");function b(n,e=",",r=!1){return Object.keys(n).reduce((o,t)=>{let i=r?t.toLowerCase():t,a=n[t];return Array.isArray(a)?o[i]=a.join(e):o[i]=(a??"")+"",o},{})}s(b,"getFlattenedHeadersMap");var d=s(()=>{},"NO_OP");var K=Symbol("InternalLogger");var ie=require("stream");var O=443,f=class extends T.IncomingMessage{static{s(this,"ServerlessRequest")}constructor({method:e,url:r,headers:o,body:t,remoteAddress:i}){super({encrypted:!0,readable:!1,remoteAddress:i,address:()=>({port:O}),end:d,destroy:d}),this.statusCode=200,this.statusMessage="OK",this.complete=!0,this.httpVersion="1.1",this.httpVersionMajor=1,this.httpVersionMinor=1,this.method=e,this.headers=o,this.body=t,this.url=r,this.ip=i,this._read=()=>{this.push(t),this.push(null)}}ip;body};var E=require("http");function h(n){if(Buffer.isBuffer(n))return n.toString("utf8");if(typeof n=="string")return n;if(n instanceof Uint8Array)return new TextDecoder().decode(n);throw new Error(`response.write() of unexpected type: ${typeof n}`)}s(h,"getString");var A=`\r
\r
`,P=`0\r
\r
`,c=Symbol("Response body"),u=Symbol("Response headers");function v(n,e){if(Buffer.isBuffer(e)||typeof e=="string"||e instanceof Uint8Array)n[c].push(Buffer.from(e));else throw new Error(`response.write() of unexpected type: ${typeof e}`)}s(v,"addData");var y=class n extends E.ServerResponse{static{s(this,"ServerlessResponse")}constructor({method:e}){super({method:e}),this[c]=[],this[u]={},this.useChunkedEncodingByDefault=!1,this.chunkedEncoding=!1,this._header="";let r=1,o={_writableState:{},writable:!0,on:d,removeListener:d,destroy:d,cork:d,uncork:d,write:(t,i,a)=>{if(typeof i=="function"&&(a=i,i=null),this._header===""||this._wroteHeader)this.chunkedEncoding?r>0?r--:t!==P&&(v(this,t),r=3):v(this,t);else{let p=h(t),l=p.indexOf(A);if(l!==-1){let S=p.slice(l+A.length);S&&!this.chunkedEncoding&&v(this,S),this._wroteHeader=!0}}typeof a=="function"&&a()}};this.assignSocket(o)}_header;_headers;_wroteHeader;[c];[u];get headers(){return this[u]}static from(e){let r=new n({method:e.method});return r.statusCode=e.statusCode||0,r[u]=e.headers,r[c]=e.body?[Buffer.from(e.body)]:[],r.end(),r}static body(e){return Buffer.concat(e[c])}static headers(e){let r=e.getHeaders();return Object.assign(r,e[u])}setHeader(e,r){this._wroteHeader?this[u][e]=r:super.setHeader(e,r)}writeHead(e,r,o){let t=typeof r=="string"?o:r,i=Array.isArray(t)?t:[t||{}];for(let a of i)for(let p in a)if(this.setHeader(p,a[p]),!this._wroteHeader)break;return this.callNativeWriteHead(e,r,o)}callNativeWriteHead(e,r,o){return super.writeHead(e,r,o)}};var _=require("http");var m=class{static{s(this,"RawRequest")}onRequestCallback(e,r){return(o,t)=>{let i=this.getRequestFromExpressRequest(o);return r.sendRequest(e,i,t)}}getRequestFromExpressRequest(e){let r=e,o=b(e.headers,",",!0),t=o["x-forwarded-for"],i;if(r.body&&typeof r.body=="object"){let a=JSON.stringify(r.body),[p,l]=R(a,!1);i=p,o["content-length"]=String(l)}return new f({method:e.method,url:e.url,body:i,headers:o,remoteAddress:t})}};var x=class extends m{constructor(r){super();this.name=r}static{s(this,"GCPHandler")}getHandler(r,o){let t=this.onRequestCallback(r,o);return(0,w.http)(this.name,t),t}};0&&(module.exports={GCPHandler});
//# sourceMappingURL=index.cjs.map