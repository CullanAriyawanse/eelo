import{s as i}from"../../chunk-MQYXRLYI.mjs";import{a as n}from"../../chunk-OYOJMOFP.mjs";import a from"cors";var d=class{constructor(t,e){this.framework=t;this.options=e;this.cachedCorsInstance=a(this.options)}static{n(this,"CorsFramework")}corsHeaders=["Access-Control-Max-Age","Access-Control-Expose-Headers","Access-Control-Allow-Headers","Access-Control-Request-Headers","Access-Control-Allow-Credentials","Access-Control-Allow-Methods","Access-Control-Allow-Origin"];cachedCorsInstance;sendRequest(t,e,o){this.cachedCorsInstance(e,o,this.onCorsNext(t,e,o))}onCorsNext(t,e,o){return()=>{if(this.formatHeaderValuesAddedByCorsPackage(o),i(this.options?.forbiddenOnInvalidOriginOrMethod,!0)){let r=o.getHeader("access-control-allow-origin");if(this.isInvalidOriginOrMethodIsNotAllowed(e,r)){o.statusCode=403,o.setHeader("Content-Type","text/plain"),o.end(["Invalid HTTP Access Control (CORS) request:",`  Origin: ${e.headers.origin}`,`  Method: ${e.method}`].join(`
`));return}}this.framework.sendRequest(t,e,o)}}formatHeaderValuesAddedByCorsPackage(t){for(let e of this.corsHeaders){let o=t.getHeader(e);o!==void 0&&(t.removeHeader(e),t.setHeader(e.toLowerCase(),Array.isArray(o)?o.join(","):o))}}isInvalidOriginOrMethodIsNotAllowed(t,e){if(!e||t.headers.origin&&e!=="*"&&t.headers.origin!==e)return!0;let o=this.options&&Array.isArray(this.options.methods)&&this.options.methods.every(r=>r.toLowerCase()!==t.method?.toLowerCase()),s=this.options&&typeof this.options.methods=="string"&&this.options.methods.split(",").every(r=>r.trim().toLowerCase()!==t.method?.toLowerCase());return!!(this.options?.methods&&(o||s))}};export{d as CorsFramework};
//# sourceMappingURL=index.mjs.map