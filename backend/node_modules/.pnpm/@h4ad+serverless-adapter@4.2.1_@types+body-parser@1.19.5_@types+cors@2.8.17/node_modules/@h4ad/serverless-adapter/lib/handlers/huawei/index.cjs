"use strict";var g=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var n=(t,e)=>g(t,"name",{value:e,configurable:!0});var B=(t,e)=>{for(var r in e)g(t,r,{get:e[r],enumerable:!0})},P=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of L(e))!k.call(t,o)&&o!==r&&g(t,o,{get:()=>e[o],enumerable:!(s=H(e,o))||s.enumerable});return t};var O=t=>P(g({},"__esModule",{value:!0}),t);var F={};B(F,{DEFAULT_HUAWEI_LISTEN_PORT:()=>C,HttpHuaweiHandler:()=>x});module.exports=O(F);var w=require("http");var _=require("http");var b=require("http");function h(t){if(Buffer.isBuffer(t))return t.toString("utf8");if(typeof t=="string")return t;if(t instanceof Uint8Array)return new TextDecoder().decode(t);throw new Error(`response.write() of unexpected type: ${typeof t}`)}n(h,"getString");var A=`\r
\r
`,I=`0\r
\r
`,l=Symbol("Response body"),u=Symbol("Response headers");function v(t,e){if(Buffer.isBuffer(e)||typeof e=="string"||e instanceof Uint8Array)t[l].push(Buffer.from(e));else throw new Error(`response.write() of unexpected type: ${typeof e}`)}n(v,"addData");var S=class t extends b.ServerResponse{static{n(this,"ServerlessResponse")}constructor({method:e}){super({method:e}),this[l]=[],this[u]={},this.useChunkedEncodingByDefault=!1,this.chunkedEncoding=!1,this._header="";let r=1,s={_writableState:{},writable:!0,on:a,removeListener:a,destroy:a,cork:a,uncork:a,write:(o,p,d)=>{if(typeof p=="function"&&(d=p,p=null),this._header===""||this._wroteHeader)this.chunkedEncoding?r>0?r--:o!==I&&(v(this,o),r=3):v(this,o);else{let i=h(o),c=i.indexOf(A);if(c!==-1){let f=i.slice(c+A.length);f&&!this.chunkedEncoding&&v(this,f),this._wroteHeader=!0}}typeof d=="function"&&d()}};this.assignSocket(s)}_header;_headers;_wroteHeader;[l];[u];get headers(){return this[u]}static from(e){let r=new t({method:e.method});return r.statusCode=e.statusCode||0,r[u]=e.headers,r[l]=e.body?[Buffer.from(e.body)]:[],r.end(),r}static body(e){return Buffer.concat(e[l])}static headers(e){let r=e.getHeaders();return Object.assign(r,e[u])}setHeader(e,r){this._wroteHeader?this[u][e]=r:super.setHeader(e,r)}writeHead(e,r,s){let o=typeof r=="string"?s:r,p=Array.isArray(o)?o:[o||{}];for(let d of p)for(let i in d)if(this.setHeader(i,d[i]),!this._wroteHeader)break;return this.callNativeWriteHead(e,r,s)}callNativeWriteHead(e,r,s){return super.writeHead(e,r,s)}};var D=require("http");var a=n(()=>{},"NO_OP");var xe=Symbol("InternalLogger");function R(t,e){return t===void 0?e:t}n(R,"getDefaultIfUndefined");var He=require("stream");var C=8e3,x=class{constructor(e){this.options=e}static{n(this,"HttpHuaweiHandler")}getHandler(e,r,s,o,p,d,i){let c=n((y,m)=>{r.sendRequest(e,y,m)},"requestListener"),f=R(this.options?.httpServerFactory,this.createHttpServer.bind(this))(c),E=R(this.options?.port,C);return f.listen(E,()=>{i.debug("SERVERLESS_ADAPTER:PROXY: Server started."),i.debug(`SERVERLESS_ADAPTER:PROXY: Listening the Huawei Requests in port ${E}`)}),()=>(i.debug("SERVERLESS_ADAPTER:PROXY: Disposing the server"),new Promise((y,m)=>{f.close(T=>T?m(T):y())}))}createHttpServer(e){return(0,w.createServer)(e)}};0&&(module.exports={DEFAULT_HUAWEI_LISTEN_PORT,HttpHuaweiHandler});
//# sourceMappingURL=index.cjs.map