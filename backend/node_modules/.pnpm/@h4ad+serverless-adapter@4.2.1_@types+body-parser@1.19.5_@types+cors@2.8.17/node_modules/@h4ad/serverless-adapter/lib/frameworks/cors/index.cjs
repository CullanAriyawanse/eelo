"use strict";var w=Object.create;var c=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var E=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var o=(t,e)=>c(t,"name",{value:e,configurable:!0});var H=(t,e)=>{for(var r in e)c(t,r,{get:e[r],enumerable:!0})},x=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of b(e))!k.call(t,s)&&s!==r&&c(t,s,{get:()=>e[s],enumerable:!(n=R(e,s))||n.enumerable});return t};var O=(t,e,r)=>(r=t!=null?w(E(t)):{},x(e||!t||!t.__esModule?c(r,"default",{value:t,enumerable:!0}):r,t)),I=t=>x(c({},"__esModule",{value:!0}),t);var _={};H(_,{CorsFramework:()=>m});module.exports=I(_);var T=O(require("cors"),1);var B=require("http");var S=require("http");function u(t){if(Buffer.isBuffer(t))return t.toString("utf8");if(typeof t=="string")return t;if(t instanceof Uint8Array)return new TextDecoder().decode(t);throw new Error(`response.write() of unexpected type: ${typeof t}`)}o(u,"getString");var A=`\r
\r
`,L=`0\r
\r
`,f=Symbol("Response body"),p=Symbol("Response headers");function g(t,e){if(Buffer.isBuffer(e)||typeof e=="string"||e instanceof Uint8Array)t[f].push(Buffer.from(e));else throw new Error(`response.write() of unexpected type: ${typeof e}`)}o(g,"addData");var y=class t extends S.ServerResponse{static{o(this,"ServerlessResponse")}constructor({method:e}){super({method:e}),this[f]=[],this[p]={},this.useChunkedEncodingByDefault=!1,this.chunkedEncoding=!1,this._header="";let r=1,n={_writableState:{},writable:!0,on:a,removeListener:a,destroy:a,cork:a,uncork:a,write:(s,i,d)=>{if(typeof i=="function"&&(d=i,i=null),this._header===""||this._wroteHeader)this.chunkedEncoding?r>0?r--:s!==L&&(g(this,s),r=3):g(this,s);else{let l=u(s),h=l.indexOf(A);if(h!==-1){let v=l.slice(h+A.length);v&&!this.chunkedEncoding&&g(this,v),this._wroteHeader=!0}}typeof d=="function"&&d()}};this.assignSocket(n)}_header;_headers;_wroteHeader;[f];[p];get headers(){return this[p]}static from(e){let r=new t({method:e.method});return r.statusCode=e.statusCode||0,r[p]=e.headers,r[f]=e.body?[Buffer.from(e.body)]:[],r.end(),r}static body(e){return Buffer.concat(e[f])}static headers(e){let r=e.getHeaders();return Object.assign(r,e[p])}setHeader(e,r){this._wroteHeader?this[p][e]=r:super.setHeader(e,r)}writeHead(e,r,n){let s=typeof r=="string"?n:r,i=Array.isArray(s)?s:[s||{}];for(let d of i)for(let l in d)if(this.setHeader(l,d[l]),!this._wroteHeader)break;return this.callNativeWriteHead(e,r,n)}callNativeWriteHead(e,r,n){return super.writeHead(e,r,n)}};var P=require("http");var a=o(()=>{},"NO_OP");var xe=Symbol("InternalLogger");function C(t,e){return t===void 0?e:t}o(C,"getDefaultIfUndefined");var be=require("stream");var m=class{constructor(e,r){this.framework=e;this.options=r;this.cachedCorsInstance=(0,T.default)(this.options)}static{o(this,"CorsFramework")}corsHeaders=["Access-Control-Max-Age","Access-Control-Expose-Headers","Access-Control-Allow-Headers","Access-Control-Request-Headers","Access-Control-Allow-Credentials","Access-Control-Allow-Methods","Access-Control-Allow-Origin"];cachedCorsInstance;sendRequest(e,r,n){this.cachedCorsInstance(r,n,this.onCorsNext(e,r,n))}onCorsNext(e,r,n){return()=>{if(this.formatHeaderValuesAddedByCorsPackage(n),C(this.options?.forbiddenOnInvalidOriginOrMethod,!0)){let i=n.getHeader("access-control-allow-origin");if(this.isInvalidOriginOrMethodIsNotAllowed(r,i)){n.statusCode=403,n.setHeader("Content-Type","text/plain"),n.end(["Invalid HTTP Access Control (CORS) request:",`  Origin: ${r.headers.origin}`,`  Method: ${r.method}`].join(`
`));return}}this.framework.sendRequest(e,r,n)}}formatHeaderValuesAddedByCorsPackage(e){for(let r of this.corsHeaders){let n=e.getHeader(r);n!==void 0&&(e.removeHeader(r),e.setHeader(r.toLowerCase(),Array.isArray(n)?n.join(","):n))}}isInvalidOriginOrMethodIsNotAllowed(e,r){if(!r||e.headers.origin&&r!=="*"&&e.headers.origin!==r)return!0;let n=this.options&&Array.isArray(this.options.methods)&&this.options.methods.every(i=>i.toLowerCase()!==e.method?.toLowerCase()),s=this.options&&typeof this.options.methods=="string"&&this.options.methods.split(",").every(i=>i.trim().toLowerCase()!==e.method?.toLowerCase());return!!(this.options?.methods&&(n||s))}};0&&(module.exports={CorsFramework});
//# sourceMappingURL=index.cjs.map