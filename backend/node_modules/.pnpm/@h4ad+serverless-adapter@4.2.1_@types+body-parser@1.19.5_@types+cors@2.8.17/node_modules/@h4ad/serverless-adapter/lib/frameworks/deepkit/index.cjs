"use strict";var l=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var n=(t,e)=>l(t,"name",{value:e,configurable:!0});var A=(t,e)=>{for(var r in e)l(t,r,{get:e[r],enumerable:!0})},C=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of E(e))!w.call(t,o)&&o!==r&&l(t,o,{get:()=>e[o],enumerable:!(s=T(e,o))||s.enumerable});return t};var k=t=>C(l({},"__esModule",{value:!0}),t);var I={};A(I,{HttpDeepkitFramework:()=>m});module.exports=k(I);var b=require("@deepkit/http");var B=require("http");var v=require("http");function c(t){if(Buffer.isBuffer(t))return t.toString("utf8");if(typeof t=="string")return t;if(t instanceof Uint8Array)return new TextDecoder().decode(t);throw new Error(`response.write() of unexpected type: ${typeof t}`)}n(c,"getString");var S=`\r
\r
`,H=`0\r
\r
`,u=Symbol("Response body"),p=Symbol("Response headers");function g(t,e){if(Buffer.isBuffer(e)||typeof e=="string"||e instanceof Uint8Array)t[u].push(Buffer.from(e));else throw new Error(`response.write() of unexpected type: ${typeof e}`)}n(g,"addData");var y=class t extends v.ServerResponse{static{n(this,"ServerlessResponse")}constructor({method:e}){super({method:e}),this[u]=[],this[p]={},this.useChunkedEncodingByDefault=!1,this.chunkedEncoding=!1,this._header="";let r=1,s={_writableState:{},writable:!0,on:d,removeListener:d,destroy:d,cork:d,uncork:d,write:(o,i,a)=>{if(typeof i=="function"&&(a=i,i=null),this._header===""||this._wroteHeader)this.chunkedEncoding?r>0?r--:o!==H&&(g(this,o),r=3):g(this,o);else{let f=c(o),h=f.indexOf(S);if(h!==-1){let x=f.slice(h+S.length);x&&!this.chunkedEncoding&&g(this,x),this._wroteHeader=!0}}typeof a=="function"&&a()}};this.assignSocket(s)}_header;_headers;_wroteHeader;[u];[p];get headers(){return this[p]}static from(e){let r=new t({method:e.method});return r.statusCode=e.statusCode||0,r[p]=e.headers,r[u]=e.body?[Buffer.from(e.body)]:[],r.end(),r}static body(e){return Buffer.concat(e[u])}static headers(e){let r=e.getHeaders();return Object.assign(r,e[p])}setHeader(e,r){this._wroteHeader?this[p][e]=r:super.setHeader(e,r)}writeHead(e,r,s){let o=typeof r=="string"?s:r,i=Array.isArray(o)?o:[o||{}];for(let a of i)for(let f in a)if(this.setHeader(f,a[f]),!this._wroteHeader)break;return this.callNativeWriteHead(e,r,s)}callNativeWriteHead(e,r,s){return super.writeHead(e,r,s)}};var L=require("http");function R(t,e=",",r=!1){return Object.keys(t).reduce((s,o)=>{let i=r?o.toLowerCase():o,a=t[o];return Array.isArray(a)?s[i]=a.join(e):s[i]=(a??"")+"",s},{})}n(R,"getFlattenedHeadersMap");var d=n(()=>{},"NO_OP");var me=Symbol("InternalLogger");var Te=require("stream");var m=class{static{n(this,"HttpDeepkitFramework")}sendRequest(e,r,s){let o=R(r.headers),i=new b.RequestBuilder(r.url,r.method).headers(o);r.body&&(i=Buffer.isBuffer(r.body)?i.body(r.body):i.body(Buffer.from(r.body)));let a=i.build();e.handleRequest(a,s)}};0&&(module.exports={HttpDeepkitFramework});
//# sourceMappingURL=index.cjs.map